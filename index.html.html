<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>แบบประเมินเพื่อเสนอปรับเลื่อนระดับ, ปรับเลื่อนตำแหน่ง (ระดับ 8)</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      background: #f8f9fa;
      color: #333;
    }
    h2 {
      color: #2c3e50;
      margin-bottom: 5px;
      text-align: center;
    }
    .dropdowns {
      max-width: 900px;
      margin: 10px auto 20px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px 30px;
      font-size: 16px;
    }
    .dropdowns label {
      display: block;
      font-weight: 600;
      margin-bottom: 5px;
    }
    .dropdowns select {
      width: 100%;
      padding: 8px 12px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .table-container {
      overflow-x: auto;
      background: #fff;
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px 15px;
      vertical-align: top;
      text-align: left;
    }
    th {
      background-color: #3498db;
      color: white;
      font-weight: 600;
    }
    input[type=number] {
      width: 140px;
      padding: 6px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      transition: border-color 0.3s;
      text-align: center;
    }
    input[type=number]:focus {
      border-color: #2980b9;
      outline: none;
    }
    textarea {
      width: 100%;
      min-height: 80px;
      max-height: 200px;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
      box-sizing: border-box;
      font-family: inherit;
    }
    textarea:focus {
      border-color: #2980b9;
      outline: none;
    }
    input#evaluatorName {
      width: 100%;
      max-width: 400px;
      padding: 12px 15px;
      font-size: 18px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
      margin: 10px auto 0 auto;
      display: block;
    }
    button {
      margin-top: 20px;
      padding: 12px 25px;
      background-color: gray;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: not-allowed;
      transition: background-color 0.3s;
      display: block;
      width: 100%;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }
    button.enabled {
      background-color: #27ae60;
      cursor: pointer;
    }
    #result {
      margin-top: 20px;
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      color: #222;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>
  <h2>แบบประเมินเพื่อเสนอปรับเลื่อนระดับ, ปรับเลื่อนตำแหน่ง (ระดับ 8)</h2>
  <div class="dropdowns">
    <div>
      <label for="recipientName">ชื่อ นามสกุล ผู้รับการประเมิน</label>
      <select id="recipientName" name="recipientName">
        <option value="">--เลือกชื่อ นามสกุล--</option>
        <option value="สมชาย ใจดี">สมชาย ใจดี</option>
        <option value="สมหญิง แสนสุข">สมหญิง แสนสุข</option>
        <option value="สมบัติ ศรีสุข">สมบัติ ศรีสุข</option>
      </select>
    </div>
    <div>
      <label for="currentPosition">ตำแหน่งปัจจุบัน</label>
      <select id="currentPosition" name="currentPosition">
        <option value="">--เลือกตำแหน่งปัจจุบัน--</option>
        <option value="เจ้าหน้าที่">เจ้าหน้าที่</option>
        <option value="หัวหน้าเจ้าหน้าที่">หัวหน้าเจ้าหน้าที่</option>
        <option value="ผู้จัดการ">ผู้จัดการ</option>
      </select>
    </div>
    <div>
      <label for="currentLevel">ระดับ</label>
      <select id="currentLevel" name="currentLevel">
        <option value="">--เลือกระดับ--</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
      </select>
    </div>
    <div>
      <label for="branch">สาย/สำนัก</label>
      <select id="branch" name="branch">
        <option value="">--เลือกสาย/สำนัก--</option>
        <option value="สายงานบริหาร">สายงานบริหาร</option>
        <option value="สายงานเทคนิค">สายงานเทคนิค</option>
        <option value="สายงานบริการ">สายงานบริการ</option>
      </select>
    </div>
    <div>
      <label for="proposedPosition">ขอเสนอปรับ ตำแหน่ง</label>
      <select id="proposedPosition" name="proposedPosition">
        <option value="">--เลือกตำแหน่งที่เสนอ--</option>
        <option value="หัวหน้าเจ้าหน้าที่">หัวหน้าเจ้าหน้าที่</option>
        <option value="ผู้จัดการ">ผู้จัดการ</option>
        <option value="กรรมการผู้บริหาร">กรรมการผู้บริหาร</option>
      </select>
    </div>
    <div>
      <label for="proposedLevel">ระดับ</label>
      <select id="proposedLevel" name="proposedLevel">
        <option value="">--เลือกระดับที่เสนอ--</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
      </select>
    </div>
  </div>
  <form id="evaluationForm">
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>ลำดับ</th>
            <th>หัวข้อการประเมิน</th>
            <th>คะแนน (1.00 - 4.00)</th>
            <th>หมายเหตุ</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>1</td><td>Achievement Orientation (D)<br><small>การมุ่งมั่นสู่ความสำเร็จ</small></td><td><input type="number" name="score1" min="1" max="4" step="0.25"></td><td><textarea name="remark1" placeholder="เขียนข้อความที่นี่..."></textarea></td></tr>
          <tr><td>2</td><td>Team &amp; Collaboration (S)<br><small>การทำงานเป็นทีมและประสานงาน</small></td><td><input type="number" name="score2" min="1" max="4" step="0.25"></td><td><textarea name="remark2" placeholder="เขียนข้อความที่นี่..."></textarea></td></tr>
          <tr><td>3</td><td>Communication &amp; Presentation (S)<br><small>การสื่อสารและการนำเสนอ</small></td><td><input type="number" name="score3" min="1" max="4" step="0.25"></td><td><textarea name="remark3" placeholder="เขียนข้อความที่นี่..."></textarea></td></tr>
          <tr><td>4</td><td>Team Leadership (S)<br><small>การเป็นผู้นำทีม</small></td><td><input type="number" name="score4" min="1" max="4" step="0.25"></td><td><textarea name="remark4" placeholder="เขียนข้อความที่นี่..."></textarea></td></tr>
          <tr><td>5</td><td>Ethics &amp; Integrity (I)<br><small>จริยธรรมจรรยาบรรณและความซื่อสัตย์</small></td><td><input type="number" name="score5" min="1" max="4" step="0.25"></td><td><textarea name="remark5" placeholder="เขียนข้อความที่นี่..."></textarea></td></tr>
          <tr><td>6</td><td>Time Management (I)<br><small>การบริหารเวลา และความสม่ำเสมอในปฏิบัติงาน</small></td><td><input type="number" name="score6" min="1" max="4" step="0.25"></td><td><textarea name="remark6" placeholder="เขียนข้อความที่นี่..."></textarea></td></tr>
          <tr><td>7</td><td>Creativity (C)<br><small>ความคิดริเริ่มสร้างสรรค์</small></td><td><input type="number" name="score7" min="1" max="4" step="0.25"></td><td><textarea name="remark7" placeholder="เขียนข้อความที่นี่..."></textarea></td></tr>
          <tr><td>8</td><td>Developing (D/C)<br><small>การพัฒนาศักยภาพ</small></td><td><input type="number" name="score8" min="1" max="4" step="0.25"></td><td><textarea name="remark8" placeholder="เขียนข้อความที่นี่..."></textarea></td></tr>
          <tr><td>9</td><td>Pro Activeness (D/C)<br><small>การดำเนินงานเชิงรุก</small></td><td><input type="number" name="score9" min="1" max="4" step="0.25"></td><td><textarea name="remark9" placeholder="เขียนข้อความที่นี่..."></textarea></td></tr>
          <tr><td>10</td><td>Positive thinking (D)<br><small>ความคิดเชิงบวก ทัศนะคติเชิงบวก</small></td><td><input type="number" name="score10" min="1" max="4" step="0.25"></td><td><textarea name="remark10" placeholder="เขียนข้อความที่นี่..."></textarea></td></tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="4" style="font-style: italic; color: #555; border-top: 1px solid #ccc; padding-top: 15px;">
              หมายเหตุ: เกณฑ์คะแนนผ่านการประเมินต้องไม่น้อยกว่า <strong>80%</strong> จาก <strong>2/3 ของจำนวนกรรมการทั้งหมด</strong>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
    <div id="result">กรุณากรอกคะแนนเพื่อดูผลการประเมิน</div>
    <div style="max-width: 600px; margin: 40px auto;">
      <label for="furtherDevelopment"><strong>ประเด็นที่ต้องพัฒนาเพิ่มเติม</strong></label>
      <textarea id="furtherDevelopment" name="furtherDevelopment" placeholder="เขียนข้อความที่นี่..." rows="4" style="width: 100%; padding: 10px; font-size: 14px; border-radius: 4px; border: 1px solid #ccc;"></textarea>
    </div>
    <div style="max-width: 400px; margin: 20px auto 0;">
      <label for="evaluatorName" class="input-label">ชื่อกรรมการผู้ประเมิน:</label>
      <input type="text" id="evaluatorName" name="evaluatorName" placeholder="กรอกชื่อกรรมการผู้ประเมิน" />
    </div>
    <button type="submit" id="submitBtn" disabled>ส่งคะแนนประเมิน</button>
  </form>

<script>
  const evaluationData = {
    "สมชาย ใจดี": {
      currentPosition: "เจ้าหน้าที่",
      currentLevel: "7",
      branch: "สายงานบริหาร"
    },
    "สมหญิง แสนสุข": {
      currentPosition: "หัวหน้าเจ้าหน้าที่",
      currentLevel: "8",
      branch: "สายงานบริการ"
    },
    "สมบัติ ศรีสุข": {
      currentPosition: "ผู้จัดการ",
      currentLevel: "9",
      branch: "สายงานเทคนิค"
    }
  };
  const scoreInputs = document.querySelectorAll('input[name^="score"]');
  const resultDiv = document.getElementById('result');
  const submitBtn = document.getElementById('submitBtn');
  const evaluatorName = document.getElementById('evaluatorName');
  const recipientNameSelect = document.getElementById('recipientName');
  const currentPositionSelect = document.getElementById('currentPosition');
  const currentLevelSelect = document.getElementById('currentLevel');
  const branchSelect = document.getElementById('branch');
  recipientNameSelect.addEventListener('change', function() {
    const selectedName = this.value;
    if (evaluationData[selectedName]) {
      currentPositionSelect.value = evaluationData[selectedName].currentPosition;
      currentLevelSelect.value = evaluationData[selectedName].currentLevel;
      branchSelect.value = evaluationData[selectedName].branch;
    } else {
      currentPositionSelect.value = "";
      currentLevelSelect.value = "";
      branchSelect.value = "";
    }
    updateSubmitBtnState();
  });
  function updateSubmitBtnState() {
    let allFilled = true;
    scoreInputs.forEach(input => {
      if (!input.value) allFilled = false;
    });
    if (!evaluatorName.value.trim()) allFilled = false;
    const dropdowns = [
      'recipientName',
      'currentPosition',
      'currentLevel',
      'branch',
      'proposedPosition',
      'proposedLevel'
    ];
    dropdowns.forEach(id => {
      const el = document.getElementById(id);
      if (!el.value) allFilled = false;
    });
    if (allFilled) {
      submitBtn.disabled = false;
      submitBtn.classList.add('enabled');
      submitBtn.style.cursor = 'pointer';
    } else {
      submitBtn.disabled = true;
      submitBtn.classList.remove('enabled');
      submitBtn.style.cursor = 'not-allowed';
    }
  }
  function updateResult() {
    let totalScore = 0;
    let scoreCount = 0;
    const maxScorePerItem = 4;
    const totalItems = scoreInputs.length;
    const maxTotalScore = maxScorePerItem * totalItems;
    scoreInputs.forEach(input => {
      if (input.value) {
        let val = parseFloat(input.value);
        if (val > 4) {
          val = 4;
          input.value = val;
        }
        totalScore += val;
        scoreCount++;
      }
    });
    if(scoreCount === 0){
      resultDiv.textContent = 'กรุณากรอกคะแนนเพื่อดูผลการประเมิน';
      resultDiv.style.color = 'black';
    } else {
      const percentage = (totalScore / maxTotalScore) * 100;
      const pass = percentage >= 80;
      resultDiv.innerHTML = `
        คะแนนรวม: <strong>${totalScore.toFixed(2)}</strong><br/>
        ร้อยละ: <strong>${percentage.toFixed(2)}%</strong><br/>
        ผลการประเมิน: <span style="color:${pass ? 'green' : 'red'}; font-weight: bold;">
          ${pass ? 'ผ่านเกณฑ์' : 'ไม่ผ่านเกณฑ์'}
        </span>
      `;
      resultDiv.style.color = '';
    }
    updateSubmitBtnState();
  }
  scoreInputs.forEach(input => {
    input.addEventListener('input', updateResult);
  });
  evaluatorName.addEventListener('input', updateResult);
  const dropdownIds = ['recipientName', 'currentPosition', 'currentLevel', 'branch', 'proposedPosition', 'proposedLevel'];
  dropdownIds.forEach(id => {
    document.getElementById(id).addEventListener('change', updateResult);
  });

  // เพิ่มโค้ดส่งข้อมูลไป Google Apps Script Web App ตรงนี้
  document.getElementById('evaluationForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    if (submitBtn.disabled) {
      alert('กรุณากรอกข้อมูลครบถ้วนก่อนส่ง');
      return;
    }

    const dataToSend = {
      evaluatorName: evaluatorName.value,
      recipientName: recipientNameSelect.value,
      currentPosition: currentPositionSelect.value,
      currentLevel: currentLevelSelect.value,
      branch: branchSelect.value,
      proposedPosition: document.getElementById('proposedPosition').value,
      proposedLevel: document.getElementById('proposedLevel').value,
      score1: document.querySelector('input[name="score1"]').value,
      remark1: document.querySelector('textarea[name="remark1"]').value,
      score2: document.querySelector('input[name="score2"]').value,
      remark2: document.querySelector('textarea[name="remark2"]').value,
      score3: document.querySelector('input[name="score3"]').value,
      remark3: document.querySelector('textarea[name="remark3"]').value,
      score4: document.querySelector('input[name="score4"]').value,
      remark4: document.querySelector('textarea[name="remark4"]').value,
      score5: document.querySelector('input[name="score5"]').value,
      remark5: document.querySelector('textarea[name="remark5"]').value,
      score6: document.querySelector('input[name="score6"]').value,
      remark6: document.querySelector('textarea[name="remark6"]').value,
      score7: document.querySelector('input[name="score7"]').value,
      remark7: document.querySelector('textarea[name="remark7"]').value,
      score8: document.querySelector('input[name="score8"]').value,
      remark8: document.querySelector('textarea[name="remark8"]').value,
      score9: document.querySelector('input[name="score9"]').value,
      remark9: document.querySelector('textarea[name="remark9"]').value,
      score10: document.querySelector('input[name="score10"]').value,
      remark10: document.querySelector('textarea[name="remark10"]').value,
      furtherDevelopment: document.getElementById('furtherDevelopment').value
    };

    try {
      const response = await fetch('https://script.google.com/macros/s/AKfycbwhJ8kmdQIce1GfN3mrcDzgLCjj771n1eO1KkLwRGgPKwuYFyOcoxwYcAeuZPhNKjHG/exec', {
        method: 'POST',
        mode: 'cors',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(dataToSend)
      });

      if (response.ok) {
        const result = await response.json();
        if (result.status === 'success') {
          alert('ส่งข้อมูลสำเร็จ');
          this.reset();
          resultDiv.textContent = 'ส่งข้อมูลสำเร็จ';
          resultDiv.style.color = 'green';
        } else {
          alert('เกิดข้อผิดพลาด: ' + (result.message || 'ไม่ทราบสาเหตุ'));
        }
      } else {
        alert('ไม่สามารถเชื่อมต่อกับเซิร์ฟเวอร์ได้');
      }
    } catch (error) {
      alert('เกิดข้อผิดพลาด: ' + error.message);
    }
  });
</script>
</body>
</html>
